@{
    ViewBag.Title = "MovieReview";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<script type="text/javascript">
    $(document).ready(function () {
        $("#updatereview").attr("style", "background-color:#f5f5f5;");
    });
</script>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Update Movie Review</h3>
    </div>
    <div class="panel-body" id="reviewinfo">

        <div id="successStatus" style="display:none" class="alert alert-success"></div>
        <div id="updationMovieReviewError" class="alert alert-danger" style="display:none;"></div>


        @using (Html.BeginForm())
        {
            @Html.DropDownList("reviewerId", (SelectList)ViewBag.movieReview, "-- Select Reviewer Name --", new { @class = "reviewInput" })
            <br />
            @*@Html.DropDownList("movieId", (SelectList)ViewBag.movie, "-- Select Movie Name --")*@
            //<br />
            @*<input type="text" name="mvoieName" id="movieName" class="reviewInput" placeholder="Search Movie Name" /><br />*@

            @*<input type="text" name="reviewerName" id="reviewerName" class="reviewInput" placeholder="Reviewer Name" /><br />*@

            <input type="text" name="reviewerRating" id="reviewerRating" class="reviewInput" placeholder="Reviewer Rating" /><br />

            @*<input type="text" name="Review" id="review" class="reviewInput" placeholder="review" />*@
            <textarea name="summary" id="review" class="reviewInput" placeholder="Review"></textarea><br />

            <input type="text" name="outlink" id="outlink" class="reviewInput" placeholder="Outlink" /><br />

            <textarea name="summary" id="summary" class="reviewInput" placeholder="summary"></textarea><br />

            @*<input type="submit" value="Save" class="btn btn-primary" name="Submit" id="saveReview" />*@
            <div class="btn btn-primary" onclick="UpdateMovieReviewDetail();">Add Movie Review</div>

            @Html.Hidden("hfUpdateMovieReview", "")
        }

    </div>
</div>

<script type="text/javascript">
    function UpdateMovieReviewDetail() {
        var isValid = true;
        try {
            var reviewerId = $('#reviewerId :selected').val();
            var movieId = $('#movieId :selected').val();

            //var movieName = $("#movieName").val();
            //var reviewerName = $("#reviewerName").val();
            var reviewerRating = $("#reviewerRating").val();
            var review = $("#review").val();
            var outlink = $("#outlink").val();
            var summary = $("#summary").val();

            if (movieId == "") {

                $("#updationMovieReviewError").html("Please provide Movie Name.");
                $("#updationMovieReviewError").show();
                $("#movieId").focus();
                isValid = false;
                return;
            }

            if (reviewerId == "") {
                $("#updationMovieReviewError").html("Please provide Reviewer Name.");
                $("#updationMovieReviewError").show();
                $("#reviewerId").focus();
                isValid = false;
                return;
            }

            if (reviewerRating == "") {
                $("#updationMovieReviewError").html("Please provide Rating.");
                $("#updationMovieReviewError").show();
                $("#reviewerRating").focus();
                isValid = false;
                return;
            }

            if (review == "") {
                $("#updationMovieReviewError").html("Please provide Review.");
                $("#updationMovieReviewError").show();
                $("#review").focus();
                isValid = false;
                return;

            }

            if (outlink == "") {
                $("#updationMovieReviewError").html("Please provide Outlink.");
                $("#updationMovieReviewError").show();
                $("#outlink").focus();
                isValid = false;
                return;
            }

            if (summary == "") {
                $("#updationMovieReviewError").html("Please provide Summary.");
                $("#updationMovieReviewError").show();
                $("#summary").focus();
                isValid = false;
                return;
            }

            if (isValid) {
                var updateReviewDetails = {
                    "MovieId": movieId,
                    "ReviewerId": reviewerId,
                    "ReviewerRating": reviewerRating,
                    "Review": review,
                    "OutLink": outlink,
                    "Summary": summary
                };

                alert(JSON.stringify(updateReviewDetails));
                $("#hfUpdateMovieReview").val(JSON.stringify(updateReviewDetails));
                alert(JSON.stringify(updateReviewDetails));

                $.ajax({
                    url: '@Url.Action("UpdateMovieReview", "Review")',
                    data: { "hfUpdateMovieReview": JSON.stringify(updateReviewDetails) },
                    type: 'POST',
                    dataType: 'json',
                    success: ShowSuccessMessage,
                    error: function (xhr, status, error) {
                    }
                });
            }
        } catch (e) {
            $("#updationMovieReviewError").html("There is some error, please try again.");
            $("#updationMovieReviewError").show();
        }
    }

    function ShowSuccessMessage(result) {
        if (result.Status == "Ok") {
            $("#successStatus").html("Movie Review details updated successfully");
            $("#successStatus").show();
            ClearformData();
        } else if (result.Status == "Error") {
            $("#successStatus").removeAttr("class");
            $("#successStatus").attr("class", "alert alert-danger");
            $("#successStatus").html("Unable to update movie review details. Please try again after some time.");
            $("#successStatus").show();
        }
    }

    function ClearformData() {
        $("#movieId").val("");
        $("#reviewerId").val("");
        $("#reviewerRating").val("");
        $("#review").val("");
        $("#outlink").val("");
        $("#summary").val("");
        $("#updationMovieReviewError").hide();
    }
</script>
